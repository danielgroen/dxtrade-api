# DXtrade API

Unofficial TypeScript client for the DXtrade trading API.
Connect, trade, and manage positions on any broker that supports DXtrade.

## Installation

npm install dxtrade-api

## Quick Start

import { DxtradeClient, ORDER_TYPE, SIDE, BROKER } from "dxtrade-api";

const client = new DxtradeClient({
  username: "your_username",
  password: "your_password",
  broker: BROKER.FTMO,
  accountId: "optional_account_id",
});

await client.connect(); // auth + persistent WebSocket (recommended)
// or: await client.auth(); // lightweight, no persistent WS

## Available Methods

### Session
- client.connect() — Auth + persistent WebSocket. Recommended for most use cases. Call this first.
- client.auth() — Lightweight: login, fetch CSRF, WebSocket handshake, optional account switch. No persistent WS.
- client.disconnect() — Close the persistent WebSocket connection
- client.login() — Authenticate with broker (called automatically by connect/auth)
- client.fetchCsrf() — Fetch CSRF token (called automatically by connect/auth)
- client.switchAccount(accountId: string) — Switch to a specific trading account

### Positions
- client.positions.get() — Get all open positions with P&L metrics merged (margin, plOpen, marketValue, etc.), returns Position.Full[]
- client.positions.close(params: Position.Close) — Close a position (supports partial closes via the quantity field)
- client.positions.closeAll() — Close all open positions with market orders
- client.positions.stream(callback: (positions: Position.Full[]) => void) — Stream real-time position updates with live P&L (requires connect()). Returns unsubscribe function.

### Orders
- client.orders.get() — Get all pending/open orders, returns Order.Get[]
- client.orders.submit(params: Order.SubmitParams) — Submit order and wait for WebSocket confirmation, returns Order.Update
  Required params: symbol, side (SIDE.BUY | SIDE.SELL), quantity, orderType (ORDER_TYPE.MARKET | LIMIT | STOP), instrumentId
  Optional params: limitPrice, stopPrice, stopLoss, takeProfit, timeInForce (TIF.GTC | DAY | GTD)
- client.orders.cancel(orderChainId: number) — Cancel a single pending order by its order chain ID
- client.orders.cancelAll() — Cancel all pending orders (fetches orders then cancels each)

### Account
- client.account.metrics() — Get equity, balance, margin, open P&L, returns Account.Metrics
- client.account.tradeJournal({ from: number, to: number }) — Fetch trade journal for date range (Unix timestamps)
- client.account.tradeHistory({ from: number, to: number }) — Fetch trade history for date range (Unix timestamps), returns Account.TradeHistory[]

### Symbols
- client.symbols.search(text: string) — Search symbols by name, returns Symbol.Suggestion[]
- client.symbols.info(symbol: string) — Get instrument info (volume limits, lot size), returns Symbol.Info
- client.symbols.limits() — Get order size limits for all symbols, returns Symbol.Limits[]

### Instruments
- client.instruments.get(params?: Partial<Instrument.Info>) — Get all instruments, optionally filtered (e.g. { type: "FOREX" })

### OHLC
- client.ohlc.get(params: OHLC.Params) — Fetch OHLC price bars for a symbol, returns OHLC.Bar[]
  Required params: symbol (string)
  Optional params: resolution (seconds, default 300), range (seconds, default 345600), maxBars (default 3500), priceField ("bid" | "ask", default "bid")

### Assessments
- client.assessments.get(params: Assessments.Params) — Fetch PnL assessments for a date range

## Enums

import { ORDER_TYPE, SIDE, ACTION, TIF, BROKER } from "dxtrade-api";

ORDER_TYPE: MARKET, LIMIT, STOP
SIDE: BUY, SELL
ACTION: OPENING, CLOSING
TIF: GTC, DAY, GTD
BROKER: LARKFUNDING, EIGHTCAP, FTMO

## Callbacks

const client = new DxtradeClient({
  ...config,
  callbacks: {
    onLogin: () => {},
    onAccountSwitch: (accountId: string) => {},
    onOrderPlaced: (order: Order.Response) => {},
    onOrderUpdate: (order: Order.Update) => {},
    onError: (error: DxtradeError) => {},
  },
});

## Error Handling

All errors are instances of DxtradeError with properties: code (string) and message (string).
Common error codes: NO_SESSION, ORDER_TIMEOUT, ORDER_ERROR, POSITION_CLOSE_ERROR, STREAM_REQUIRES_CONNECT.
